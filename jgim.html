<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<script language="javascript" src="charset.js"></script>
<script type="text/javascript">

function isUndefined(v)
{
	if (v == undefined)
		return true;
	return false;
}

function pattnNotBelongsTo(pattn, pattns)
{
	for (var i in pattns) {
		var p = pattns[i];
		if (p == pattn)
			return false;
	}
	return true;
}

function pattnBelongsTo(pattn, pattns)
{
	return !pattnNotBelongsTo(pattn, pattns);
}

function laterInMapping(later, scode)
{
	var c;
	var pattns;
	var s_idx = 0;
	var l_idx = 0;
	var scode_len = scode.length;
	var later_len = later.length;

	if (scode_len > later_len)
		return false;

	for (; s_idx < scode_len; s_idx++) {
		c = scode.charAt(s_idx).toUpperCase();
		/* pattns is asured to be exist */
		pattns = bushou_maps[c];
		/* search from last l_idx+1 */
		for (; l_idx < later_len; l_idx++) {
			if (pattnBelongsTo(later[l_idx], pattns)) {
				break;
			}
		}
		if (l_idx >= later_len) {
			return false;
		} else {
			/* search from next partial next time */
			l_idx++;
		}
	}
	return true;
}

function scodeNotInLaterMap(scode)
{
	var c;
	for (var i = scode.length-1; i >= 0; i--) {
		c = scode.charAt(i).toUpperCase();
		if (isUndefined(bushou_maps[c])) {
			return true;
		}
	}
	return false;
}

function scode_change()
{
	var input = document.getElementById("input");
	var candi = document.getElementById("candidates");
	var scode = input.value;
	var patterns = pattern_maps[scode.charAt(0).toUpperCase()];
	if (isUndefined(patterns)) {
		candi.value = "No first pattern.";
		return;
	}
	if (scodeNotInLaterMap(scode.substring(1))) {
		candi.value = "No later patial.";
		return;
	}

	var candidates = new Array();
	for (var i in Characters) {
		var c = Characters[i];
		if (pattnNotBelongsTo(c.first, patterns)) {
			continue;
		}
		if (scode.length == 1) {
			candidates[candidates.length] = c;
		} else if (laterInMapping(c.later, scode.substring(1))) {
			candidates[candidates.length] = c;
		}
	}
	var candi_chars = "";
	for (var i in candidates) {
		var c = candidates[i];
		candi_chars += c.char + " ";
	}
	candi.value = candi_chars;
}

</script>

</head>

<body>
	Input: <input type="text" id='input' onkeyup="scode_change()"><br /><br />
	Candidates: <br />
	<textarea  id="candidates" style="width: 250px; height: 230px;">
	</textarea>
</body>

</html>
